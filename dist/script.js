import{NumberFuncs,StringFuncs,DateFuncs,Dom,Fetch}from"./scripts/Funcs.js";let numFn=new NumberFuncs,strFn=new StringFuncs,dateFn=new DateFuncs,dom=new Dom,fetchFn=new Fetch,canvasDom=(dom.setCopyright(),dom.select("canvas")),info=dom.select("h2"),scoreDOM=dom.select("h3:nth-of-type(1) span"),highscoreDOM=dom.select("h3:nth-of-type(2) span"),canvas=dom.canvas(canvasDom),size=20,cWidth=Math.floor(canvasDom.width/size),cHeight=Math.floor(canvasDom.height/size),speeds=[20,40,80,160],directions={z:["UP","DOWN"],q:["LEFT","RIGHT"],s:["DOWN","UP"],d:["RIGHT","LEFT"]},highScoreHist=fetchFn.local("highscore"),snake={speed:2,direction:"RIGHT",body:[[150,90],[130,90],[110,90]]},food=[],isPlaying=!1,reset=!1,score=0,highscore=highScoreHist.get()??0,startTime=null;function setFoodPos(){var o=Math.floor(numFn.rand(cWidth+.5,.5)*size),s=Math.floor(numFn.rand(cHeight+.5,.5)*size);for(let e=0;e<snake.body.length;e++)if(o===snake.body[e][0]&&s===snake.body[e][1])return setFoodPos();food=[o,s]}function drawSnake(){for(let e=0;e<snake.body.length;e++)canvas.draw(snake.body[e],size,"arc",!0,"green")}function drawFood(){canvas.draw(food,size,"arc",!0,"red")}function init(){setFoodPos(),drawSnake(),drawFood(),setScore()}function move(e){if(!reset)return e=e.key,isPlaying?void(Object.keys(directions).includes(e)&&snake.direction!==directions[e][1]&&(snake.direction=directions[e][0])):" "!==e?void 0:(isPlaying=!0,dom.modClass(canvasDom,"is-playing"),requestAnimationFrame(gameLoop))}function gameLoop(e){if(isPlaying){if(startTime=startTime||e,snake.speed=numFn.clamp(snake.speed,0,3),!(e<startTime+speeds[snake.speed])){startTime=e,canvas.clear();for(let e=snake.body.length-1;0<e;e--)snake.body[e][0]=snake.body[e-1][0],snake.body[e][1]=snake.body[e-1][1];var o=snake.body[0];switch(snake.direction){case"UP":o[1]-=size,o[1]=o[1]<size/2?Math.floor(canvasDom.height-size/2):o[1];break;case"LEFT":o[0]-=size,o[0]=o[0]<size/2?Math.floor(canvasDom.width-size/2):o[0];break;case"DOWN":o[1]+=size,o[1]=o[1]>Math.floor(canvasDom.height-size/2)?size/2:o[1];break;case"RIGHT":o[0]+=size,o[0]=o[0]>Math.floor(canvasDom.width-size/2)?size/2:o[0]}drawSnake(),drawFood(),grow(),die()}return requestAnimationFrame(gameLoop)}}function eat(e){return snake.body[0][0]===e[0]&&snake.body[0][1]===e[1]}function grow(){eat(food)&&(snake.body.push([]),score+=size,highscore=score>highscore?score:highscore,highScoreHist.set(highscore),setScore(),setFoodPos())}function setScore(){scoreDOM.textContent=score,highscoreDOM.textContent=highscore}function die(){for(let e=1;e<snake.body.length;e++)eat(snake.body[e])&&resetGame()}function resetGame(){reset=!0,isPlaying=!1,info.textContent="ðŸ’€",dom.modClass(canvasDom,"is-playing","del"),setTimeout(()=>{reset=!1,canvas.clear(),info.textContent="[ESPACE] pour Jouer.",snake={speed:2,direction:"RIGHT",body:[[150,90],[130,90],[110,90]]},food=[],score=0,init()},1e3)}init(),addEventListener("keydown",move);export{numFn,strFn,dateFn,dom,fetchFn};
import{dom,fetchFn,numFn}from"../script.js";export default async function(){try{let o=dom.select("canvas");if(!(o instanceof HTMLCanvasElement))throw new Error("Invalid canvas.");let n=dom.select("h2"),e=dom.select("h3:nth-of-type(1) span"),t=dom.select("h3:nth-of-type(2) span"),r=dom.canvas(o),d=20,a=Math.floor(o.width/d),i=Math.floor(o.height/d),c=[20,40,80,160],s={z:["UP","DOWN"],q:["LEFT","RIGHT"],s:["DOWN","UP"],d:["RIGHT","LEFT"]},l=fetchFn.local("highscore"),h={speed:2,direction:"RIGHT",body:[[150,90],[130,90],[110,90]]},f=[],u=!1,y=!1,m=0,b=l.get()??0,p=null;function g(){var t=Math.floor(numFn.rand(a+.5,.5)*d),o=Math.floor(numFn.rand(i+.5,.5)*d);for(let e=0;e<h.body.length;e++)if(t===h.body[e][0]&&o===h.body[e][1])return g();f=[t,o]}function F(){for(let e=0;e<h.body.length;e++)r.draw(h.body[e],d,"arc",!0,"green")}function v(){r.draw(f,d,"arc",!0,"red")}function T(){g(),F(),v(),C()}function w(e){if(u){if(p=p||e,h.speed=numFn.clamp(h.speed,0,3),!(e<p+c[h.speed])){p=e,r.clear();for(let e=h.body.length-1;0<e;e--)h.body[e][0]=h.body[e-1][0],h.body[e][1]=h.body[e-1][1];var t=h.body[0];switch(h.direction){case"UP":t[1]-=d,t[1]=t[1]<d/2?Math.floor(o.height-d/2):t[1];break;case"LEFT":t[0]-=d,t[0]=t[0]<d/2?Math.floor(o.width-d/2):t[0];break;case"DOWN":t[1]+=d,t[1]=t[1]>Math.floor(o.height-d/2)?d/2:t[1];break;case"RIGHT":t[0]+=d,t[0]=t[0]>Math.floor(o.width-d/2)?d/2:t[0]}F(),v(),M(f)&&(h.body.push([]),m+=d,b=m>b?m:b,l.set(b),C(),g());for(let e=1;e<h.body.length;e++)M(h.body[e])&&(y=!0,u=!1,n.textContent="ðŸ’€",dom.modClass(o,"is-playing","del"),setTimeout(()=>{y=!1,r.clear(),n.textContent="[ESPACE] pour Jouer.",h={speed:2,direction:"RIGHT",body:[[150,90],[130,90],[110,90]]},f=[],m=0,T()},1e3))}return requestAnimationFrame(w)}}function M(e){return h.body[0][0]===e[0]&&h.body[0][1]===e[1]}function C(){e.textContent=m,t.textContent=b}T(),addEventListener("keydown",function(e){if(!y)return e=e.key,u?void(Object.keys(s).includes(e)&&h.direction!==s[e][1]&&(h.direction=s[e][0])):" "!==e?void 0:(u=!0,dom.modClass(o,"is-playing"),requestAnimationFrame(w))})}catch(e){return dom.error(e)}}